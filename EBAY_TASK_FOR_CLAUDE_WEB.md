# eBay MVP ‚Äî –ó–∞–¥–∞—á–∞ –¥–ª—è Claude Web

**–í–ê–ñ–ù–û**: –¢—ã Senior Django/DRF —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫. –ü–∏—à–∏ —Ä–∞–±–æ—á–∏–π –∫–æ–¥ –±–µ–∑ –±–æ–ª—Ç–æ–≤–Ω–∏. –°–æ–∑–¥–∞–π –º–∏–Ω–∏–º–∞–ª—å–Ω–æ-–∂–∏–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞ eBay.

---

## üìã –¢–ó: –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –ö–æ–Ω—Ç–µ–∫—Å—Ç (–∂—ë—Å—Ç–∫–∏–µ —Ñ–∞–∫—Ç—ã):

- 1 eBay-–∞–∫–∫–∞—É–Ω—Ç; –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Business Policies (shipping/return/payment)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–∑–Ω—ã–µ (–ø–∞—Ä—Ñ—é–º, –æ–±—É–≤—å, –æ–¥–µ–∂–¥–∞, —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞, ¬´–±–∞—Ä–∞—Ö–ª–æ¬ª)
- –§–æ—Ç–æ –ø–æ–∫–∞ —Ö–æ—Å—Ç—è—Ç—Å—è –Ω–∞ –Ω–∞—à–µ–º –¥–æ–º–µ–Ω–µ `https://pochtoy.us`
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞: –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, UPC/EAN/ISBN –∏ –≤–∏–∑—É–∞–ª—É (–¥–æ–ø—É—Å–∫–∞–µ–º –ª–∏—Å—Ç–∏–Ω–≥ –±–µ–∑ –∫–∞—Ç–∞–ª–æ–≥-–º–∞—Ç—á–∞)
- –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ: –≤—Å–µ–≥–¥–∞ –Ω–∏–∂–µ –º–µ–¥–∏–∞–Ω—ã —Ä—ã–Ω–∫–∞; free shipping –≤–∫–ª—é—á—ë–Ω –≤ —Ü–µ–Ω—É
- –ù—É–∂–µ–Ω —Å–∞–π–¥–±–∞—Ä-–ø–æ–º–æ—â–Ω–∏–∫ —Ü–µ–Ω—ã (–∫–æ–º–ø—ã, –º–µ–¥–∏–∞–Ω–∞, –ø–æ–¥—Å–∫–∞–∑–∫–∏)
- –û–¥–∏–Ω —Å–∫–ª–∞–¥, —Ç–æ–≤–∞—Ä –º–æ–∂–µ—Ç –ª–µ–∂–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö; –Ω—É–∂–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç –ø—Ä–æ–¥–∞–∂–∏
- –ë—é–¥–∂–µ—Ç GPT ‚Äî –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (—Å–¥–µ–ª–∞–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏)
- –î–∞–ª–µ–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è Shopify, –ø–æ—ç—Ç–æ–º—É —Å–¥–µ–ª–∞–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π –ø–∞–±–ª–∏—à–µ—Ä

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (MVP –∑–∞ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥):

**1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `apps/marketplaces/ebay/` + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–∞—Ç–∞–ª–æ–≥**

**2. –ú–æ–¥–µ–ª–∏ (–º–∏–Ω–∏–º—É–º, —Å–æ —à—Ç–∞–º–ø–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏):**

–ò—Å–ø–æ–ª—å–∑—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å `PhotoBatch` (—Å–º. –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∏–∂–µ) –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤.

- `EbayCandidate`: 
  - `photo_batch` (FK to PhotoBatch)
  - `status` {draft, ready, listed, error, ended}
  - `category_id`, `ebay_item_id`, `condition`
  - `specifics` JSON
  - `description_md`
  - `title` (<=80)
  - `price_suggested`, `price_final`
  - `comps` JSON
  - `photos` JSON (—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ URLs)
  - `policies` JSON
  - `logs` JSON
  - `heavy_flag` bool
  - timestamps

- `EbayToken`:
  - `account='default'`
  - `access_token`, `refresh_token`
  - `expires_at`
  - `sandbox` bool
  - timestamps

**3. –ê–¥–º–∏–Ω–∫–∞:**

- –í —Å–ø–∏—Å–∫–µ `PhotoBatch` –¥–æ–±–∞–≤–∏—Ç—å mass action ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ eBay¬ª ‚Äî —Å–æ–∑–¥–∞—ë—Ç `EbayCandidate` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `draft`
- –°–ª–µ–≤–∞ (–≤ –∞–¥–º–∏–Ω–∫–µ) ‚Äî –≤–∫–ª–∞–¥–∫–∞ ¬´eBay¬ª —Å–æ —Å–ø–∏—Å–∫–æ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:
  - –§–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏/heavy
  - –î–µ–π—Å—Ç–≤–∏—è: ¬´–£–¥–∞–ª–∏—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞¬ª, ¬´–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å¬ª, ¬´–°–Ω—è—Ç—å¬ª, ¬´–û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É –ø–æ –º–µ–¥–∏–∞–Ω–µ¬ª
- –í –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞ (–¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ `PhotoBatch`) ‚Äî —Å–µ–∫—Ü–∏—è ¬´eBay Listing¬ª:
  - Drag&drop —Ñ–æ—Ç–æ (–ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ, –≤—ã–±–æ—Ä –≥–ª–∞–≤–Ω–æ–π)
  - –ü–æ–ª—è: Title, Condition, Category (autocomplete), Item specifics (–¥–∏–Ω–∞–º–∏—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
  - Description (Markdown)
  - –°–∞–π–¥–±–∞—Ä —Ü–µ–Ω—ã: –º–µ–¥–∏–∞–Ω–∞, p25/p75, –ø–æ–ª–µ ¬´–Ω–∏–∂–µ –º–µ–¥–∏–∞–Ω—ã –Ω–∞ X%¬ª, —á–µ–∫–±–æ–∫—Å Best Offer, —Ä–∞—Å—á—ë—Ç `price_final = median*(1‚àíX%) + ship_cost`

**4. API-—Å–ª–æ–π (DRF):**

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/ebay/...`:
- `POST /candidates/bulk-create` {photo_batch_ids: []}
- `GET /candidates` (—Ñ–∏–ª—å—Ç—Ä—ã status, q –ø–æ sku/title)
- `POST /candidates/{id}/prepare` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
- `POST /candidates/{id}/publish` / `POST /{id}/end` / `POST /{id}/reprice`
- `GET /taxonomy/suggest?q=...` ‚Äî –ø–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `GET /specifics?category_id=...` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ item specifics
- `GET /pricing/comps?q|upc|ean=...` ‚Äî –∫–æ–º–ø—ã –∏ –º–µ–¥–∏–∞–Ω–∞

–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –ø–æ–¥ `EbayCandidate` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã.

**5. –ü–∞–π–ø–ª–∞–π–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ (service-—Å–ª–æ–π):**

- `gpt_vision_extract(images)` ‚Äî –≤–µ—Ä–Ω–∏ `{brand, model, variant, volume, condition_guess, codes[], key_terms[]}`. **–ü–æ–∫–∞ —Å–¥–µ–ª–∞–π –∑–∞–≥–ª—É—à–∫—É** —Å –ø—Ä–æ—Å—Ç—ã–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ –∏ —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º–∏ –ø–æ–ª—è–º–∏.
- `taxonomy_suggest()` ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏—è
- `fetch_required_specifics(category_id)` ‚Üí —Å–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤
- `gpt_write_listing(data)` ‚Üí `{title, condition, specifics{}, bullets[], description_md}` (title <=80 —Å–∏–º–≤–æ–ª–æ–≤)
- `browse_comps(query/codes)` ‚Üí –≤—ã–±–æ—Ä —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã—Ö –ª–æ—Ç–æ–≤, —Ä–∞—Å—á—ë—Ç –º–µ–¥–∏–∞–Ω—ã/p25/p75
- `finalize_price(median, ship_cost, X%)` ‚Üí `price_suggested`, `price_final`. –£—á–µ—Å—Ç—å free shipping
- –ü—Ä–∏—Å–≤–æ–∏—Ç—å —Å—Ç–∞—Ç—É—Å `ready` –µ—Å–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ specifics –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–∏—Ç—å `draft` –∏ –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª–µ–π

**6. –ü—É–±–ª–∏–∫–∞—Ü–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**

- –ö–ª–∞—Å—Å `EbayClient` —Å –º–µ—Ç–æ–¥–∞–º–∏-–∑–∞–≥–ª—É—à–∫–∞–º–∏:
  - `create_or_update_listing(candidate)`
  - `upload_media(urls)`
  - `end_listing(item_id)`
  - `get_business_policies()`
  - `get_required_specifics(category_id)`
  - `search_comps(...)`
- –•—Ä–∞–Ω–∏—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ª–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ (–¥–∞–∂–µ –¥–ª—è –∑–∞–≥–ª—É—à–µ–∫)

**7. –û—á–µ—Ä–µ–¥–∏:**

- Celery —Å –æ—á–µ—Ä–µ–¥—è–º–∏ `ebay_io`, `pricing`, `gpt`
- –ó–∞–¥–∞—á–∏: `prepare`, `publish`, `end`, `reprice` (–º–∞—Å—Å–æ–≤–æ –∏ –ø–æ –æ–¥–Ω–æ–º—É)

**8. UI (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ, –±–µ–∑ —Ç—è–∂—ë–ª–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–∞):**

- –®–∞–±–ª–æ–Ω—ã Django –∏–ª–∏ –ø—Ä–æ—Å—Ç–∞—è HTMX-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ –±–ª–æ–∫–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞
- Drag&drop —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ `<input type="file" multiple>` + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (SortableJS) ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω —Å—Ç–∞—Ç–∏–∫; –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏ –ø–æ—Ä—è–¥–æ–∫ —Ñ–æ—Ç–æ

**9. –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

- `bulk_publish`, `bulk_end`, `bulk_reprice`, `bulk_delete_from_list`
- –û—Ç—á—ë—Ç –æ–± –æ—à–∏–±–∫–∞—Ö: –ø–æ–∫–∞–∑—ã–≤–∞–π —Ç–æ–ª—å–∫–æ —É–ø–∞–≤—à–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å –ø—Ä–∏—á–∏–Ω–æ–π

**10. –ü—Ä–æ–¥–∞–∂–∏/–æ—Å—Ç–∞—Ç–∫–∏:**

- –í `PhotoBatch` –¥–æ–±–∞–≤—å –ø–æ–ª–µ `locations` JSON –¥–µ—Ä–∂–∏–º –º–∞—Å—Å–∏–≤ `{name, qty}`. –ü—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—É–º–º–∞—Ä–Ω—ã–π qty = —Å—É–º–º–∞ –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
- –î–æ–±–∞–≤—å –ø—Ä–æ—Å—Ç—É—é –∫–æ–º–∞–Ω–¥—É `sync_ebay_sales` (management command), –∫–æ—Ç–æ—Ä–∞—è —É–º–µ–Ω—å—à–∞–µ—Ç qty –ø–æ –∑–∞–∫–∞–∑–∞–º –∏–∑ `EbayClient.fetch_orders()` (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)

---

## üìÇ –ù–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –ù–£–ñ–ù–û —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å:

```
apps/marketplaces/ebay/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ models.py           # EbayCandidate, EbayToken
‚îú‚îÄ‚îÄ admin.py            # mass action, –≤–∫–ª–∞–¥–∫–∞ ¬´eBay¬ª, –∏–Ω–ª–∞–π–Ω —Å–µ–∫—Ü–∏—è
‚îú‚îÄ‚îÄ serializers.py      # DRF serializers
‚îú‚îÄ‚îÄ views.py            # DRF viewsets/views
‚îú‚îÄ‚îÄ urls.py             # /api/ebay/* –º–∞—Ä—à—Ä—É—Ç—ã
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ pipeline.py     # prepare workflow
‚îÇ   ‚îú‚îÄ‚îÄ pricing.py      # comps, median, pricing
‚îÇ   ‚îú‚îÄ‚îÄ gpt.py          # vision + writer stubs
‚îÇ   ‚îî‚îÄ‚îÄ client.py       # EbayClient stub
‚îú‚îÄ‚îÄ tasks.py            # Celery tasks
‚îú‚îÄ‚îÄ templates/ebay/
‚îÇ   ‚îú‚îÄ‚îÄ candidates_list.html
‚îÇ   ‚îî‚îÄ‚îÄ partials/
‚îÇ       ‚îî‚îÄ‚îÄ product_ebay_block.html
‚îî‚îÄ‚îÄ management/
    ‚îî‚îÄ‚îÄ commands/
        ‚îî‚îÄ‚îÄ sync_ebay_sales.py
```

**–¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏:**
- `shoessite/shoessite/settings.py` ‚Äî –¥–æ–±–∞–≤—å app –≤ `INSTALLED_APPS`, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `shoessite/shoessite/urls.py` ‚Äî –ø–æ–¥–∫–ª—é—á–∏ `/ebay/` –∏ `/api/ebay/`

---

## üèóÔ∏è –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
shoesbot/
‚îú‚îÄ‚îÄ shoessite/              # Django –ø—Ä–æ–µ–∫—Ç
‚îÇ   ‚îú‚îÄ‚îÄ shoessite/          # Settings & URLs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ photos/             # –°—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Ç–æ–≤–∞—Ä—ã/—Ñ–æ—Ç–æ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py       # PhotoBatch, Photo, BarcodeResult
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ manage.py
‚îî‚îÄ‚îÄ apps/                   # –°–æ–∑–¥–∞–π —Ç—É—Ç –Ω–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ marketplaces/
        ‚îî‚îÄ‚îÄ ebay/           # <-- –¢–£–¢ –¢–í–û–ô –ö–û–î
```

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ (photos/models.py):

```python
class PhotoBatch(models.Model):
    """–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ - –±–∞—Ç—á —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑ Telegram –±–æ—Ç–∞."""
    correlation_id = models.CharField(max_length=32, unique=True, db_index=True)
    chat_id = models.BigIntegerField(db_index=True)
    message_ids = models.JSONField(default=list)
    uploaded_at = models.DateTimeField(default=timezone.now)
    processed_at = models.DateTimeField(null=True, blank=True)
    status = models.CharField(max_length=20, choices=[...], default='pending')
    
    # –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    title = models.CharField(max_length=500, blank=True)
    description = models.TextField(blank=True)
    price = models.DecimalField(max_digits=10, decimal_places=2, null=True, blank=True)
    condition = models.CharField(max_length=50, choices=[...], blank=True)
    category = models.CharField(max_length=200, blank=True)
    brand = models.CharField(max_length=200, blank=True)
    size = models.CharField(max_length=100, blank=True)
    color = models.CharField(max_length=100, blank=True)
    sku = models.CharField(max_length=200, blank=True)
    quantity = models.IntegerField(default=1)
    ai_summary = models.TextField(blank=True)

class Photo(models.Model):
    """–§–æ—Ç–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞."""
    batch = models.ForeignKey(PhotoBatch, related_name='photos', on_delete=models.CASCADE)
    file_id = models.CharField(max_length=255)
    message_id = models.BigIntegerField()
    image = models.ImageField(upload_to='photos/%Y/%m/%d/')
    uploaded_at = models.DateTimeField(default=timezone.now)
    is_main = models.BooleanField(default=False)
    order = models.IntegerField(default=0)

class BarcodeResult(models.Model):
    """–ë–∞—Ä–∫–æ–¥ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –Ω–∞ —Ñ–æ—Ç–æ."""
    photo = models.ForeignKey(Photo, related_name='barcodes', on_delete=models.CASCADE)
    symbology = models.CharField(max_length=50)
    data = models.CharField(max_length=500)
    source = models.CharField(max_length=50)  # zbar, opencv-qr, vision-ocr, gg-label
```

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π settings.py (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞—Å—Ç–∏):

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'photos',
    # <-- –î–û–ë–ê–í–¨ –°–Æ–î–ê 'apps.marketplaces.ebay'
]

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

STATIC_URL = 'static/'
STATIC_ROOT = BASE_DIR.parent / 'static'
MEDIA_URL = 'media/'
MEDIA_ROOT = BASE_DIR / 'media'

# <-- –î–û–ë–ê–í–¨ –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï:
# EBAY_SANDBOX = True
# EBAY_APP_ID = ''
# EBAY_DEV_ID = ''
# EBAY_CERT_ID = ''
# GPT_PROVIDER = 'openai'  # stub for now
# PRICE_BELOW_MEDIAN_PCT = 0.08  # 8%
# DEFAULT_SHIP_COST = 4.99
```

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π urls.py:

```python
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static
from django.views.generic import RedirectView

urlpatterns = [
    path('', RedirectView.as_view(url='/photos/sorting/', permanent=False)),
    path('admin/', admin.site.urls),
    path('photos/', include('photos.urls')),
    # <-- –î–û–ë–ê–í–¨:
    # path('ebay/', include('apps.marketplaces.ebay.urls')),
    # path('api/ebay/', include('apps.marketplaces.ebay.urls')),  # –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π urls –¥–ª—è API
]

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã admin.py (–∫–∞–∫ –¥–µ–ª–∞–µ–º):

```python
from django.contrib import admin
from django.utils.html import format_html

@admin.register(PhotoBatch)
class PhotoBatchAdmin(admin.ModelAdmin):
    list_display = ['correlation_id_link', 'product_title', 'status', 'photo_count']
    list_filter = ['status', 'uploaded_at']
    search_fields = ['correlation_id', 'title']
    actions = ['send_to_ebay']  # <-- –¢–í–û–ô MASS ACTION
    
    @admin.action(description='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ eBay')
    def send_to_ebay(self, request, queryset):
        # –°–æ–∑–¥–∞–π EbayCandidate –¥–ª—è –∫–∞–∂–¥–æ–≥–æ PhotoBatch
        pass
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:

‚úÖ –í –∞–¥–º–∏–Ω–∫–µ —É —Ç–æ–≤–∞—Ä–æ–≤ (`PhotoBatch`) –ø–æ—è–≤–∏–ª—Å—è mass action ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ eBay¬ª
‚úÖ –í–∫–ª–∞–¥–∫–∞ ¬´eBay¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏/–ø–æ–∏—Å–∫–æ–º –∏ –º–∞—Å—Å–æ–≤—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
‚úÖ –í –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞ –≤–∏–¥–Ω–æ –±–ª–æ–∫ ¬´eBay Listing¬ª —Å —Ñ–æ—Ç–æ, –∞–≤—Ç–æ–ø–æ–ª—è –∏ –ø—Ä–∞–π—Å-—Å–∞–π–¥–±–∞—Ä (–ø—É—Å—Ç—å –¥–∞–∂–µ —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö ‚Äî –æ—Ç –∑–∞–≥–ª—É—à–µ–∫)
‚úÖ `POST /api/ebay/candidates/{id}/prepare` –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç —Ü–µ–Ω—É (–Ω–∏–∂–µ –º–µ–¥–∏–∞–Ω—ã + –¥–æ—Å—Ç–∞–≤–∫–∞)
‚úÖ `POST /api/ebay/candidates/{id}/publish` –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `listed` (—á–µ—Ä–µ–∑ –º–æ–∫-–∫–ª–∏–µ–Ω—Ç), `end` ‚Äî –Ω–∞ `ended`
‚úÖ –õ–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `EbayCandidate.logs`
‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
‚úÖ `python manage.py migrate` —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

- **–ü–∏—à–∏ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã/–≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã** –¥–ª—è item specifics, –ø—Ä–æ–≤–µ—Ä—è–π Title ‚â§80 —Å–∏–º–≤–æ–ª–æ–≤
- **–ù–µ –∑–∞–≤—è–∑—ã–≤–∞–π—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π eBay —Å–µ–π—á–∞—Å** ‚Äî –∫–ª–∏–µ–Ω—Ç –∏ –æ—Ç–≤–µ—Ç—ã —Å–º–æ–∫–∞–π, –Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø–æ–¥–º–µ–Ω–∏—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã Sell/Browse/Taxonomy
- **–ö–æ–¥ ‚Äî PEP8, –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞, —Ç–∏–ø—ã (mypy-friendly), –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
- **–ù–ï –¢–†–û–ì–ê–ô –ë–û–¢** ‚Äî –≤–µ—Å—å –∫–æ–¥ —Ç–æ–ª—å–∫–æ –≤ Django (`shoessite/` –∏ `apps/`)

---

## üì¶ –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è GPT (–≥–æ—Ç–æ–≤—ã–µ –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –¥–ª—è –∑–∞–≥–ª—É—à–µ–∫):

### Vision-extract (OCR –ª–µ–π–±–ª–æ–≤/–∫–æ–¥–æ–≤)

```
–í—Ö–æ–¥: 1-10 —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ (–ª–µ–π–±–ª—ã/—à—Ç—Ä–∏—Ö-–∫–æ–¥—ã/–∫–æ—Ä–æ–±–∫–∞).
–ó–∞–¥–∞—á–∞: –∏–∑–≤–ª–µ–∫–∏ –±—Ä–µ–Ω–¥, –ª–∏–Ω–µ–π–∫—É/–º–æ–¥–µ–ª—å, –æ–±—ä—ë–º/—Ä–∞–∑–º–µ—Ä, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ–¥—ã (UPC/EAN/ISBN), –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã.
–ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã ‚Äî UNKNOWN.
–í–µ—Ä–Ω–∏ JSON: {brand, model, variant, volume, condition_guess, codes:[{type,value}], key_terms[]}.
–ù–µ –≤—ã–¥—É–º—ã–≤–∞–π.
```

### Listing-writer (title/description/specifics)

```
–í—Ö–æ–¥: JSON c –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è eBay-–∫–∞—Ç–µ–≥–æ—Ä–∏—è, —è–∑—ã–∫=EN.
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: title ‚â§80 —Å–∏–º–≤–æ–ª–æ–≤: Brand + Model + Size/Volume + Condition.
–û–ø–∏—Å–∞–Ω–∏–µ: 2‚Äì3 –∞–±–∑–∞—Ü–∞ + 5 –±—É–ª–ª–µ—Ç–æ–≤; –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π, –±–µ–∑ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö claims.
–í–µ—Ä–Ω–∏ JSON: {title, condition, specifics:{...}, bullets:[...], description_md}.
–ï—Å–ª–∏ –∞—Ç—Ä–∏–±—É—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –ø–æ–º–µ—Ç—å REQUIRED_MISSING.
```

### Comps-selector

```
–í—Ö–æ–¥: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã eBay Browse/Find (—Ü–µ–Ω–∞/—Å–æ—Å—Ç–æ—è–Ω–∏–µ/–ª–æ–∫–∞—Ü–∏—è/—Ä–µ–ø—É—Ç–∞—Ü–∏—è).
–û—Ç–±–µ—Ä–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã, –ø–æ—Å—á–∏—Ç–∞–π –º–µ–¥–∏–∞–Ω—É.
–í–µ—Ä–Ω–∏ {selected_ids:[...], median, p25, p75}.
```

### Price-finalizer

```
–í—Ö–æ–¥: median/p25/p75, X% —Å–Ω–∏–∂–µ–Ω–∏—è, ship_cost.
–í–µ—Ä–Ω–∏ {price_suggested, rationale}.
```

---

## üß™ –¢–µ—Å—Ç—ã (tests/test_ebay_pipeline.py):

```python
from django.test import TestCase
from photos.models import PhotoBatch
from apps.marketplaces.ebay.models import EbayCandidate
from apps.marketplaces.ebay.services.pipeline import prepare_candidate

class EbayPipelineTestCase(TestCase):
    def test_prepare_candidate(self):
        # –°–æ–∑–¥–∞—ë–º PhotoBatch
        batch = PhotoBatch.objects.create(
            correlation_id='test123',
            chat_id=123,
            title='Test Product',
        )
        
        # –°–æ–∑–¥–∞—ë–º EbayCandidate
        candidate = EbayCandidate.objects.create(
            photo_batch=batch,
            status='draft',
        )
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º prepare
        result = prepare_candidate(candidate.id)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º
        candidate.refresh_from_db()
        self.assertIn(candidate.status, ['draft', 'ready'])
        self.assertIsNotNone(candidate.price_suggested)
        self.assertTrue(len(candidate.logs) > 0)
```

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** `apps/marketplaces/ebay/` —Å–æ –≤—Å–µ–º–∏ —Ñ–∞–π–ª–∞–º–∏
2. **–ù–∞–ø–∏—à–∏ –º–æ–¥–µ–ª–∏** `EbayCandidate` –∏ `EbayToken` —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π –≤ –∞–¥–º–∏–Ω–∫—É** ‚Äî mass action, –≤–∫–ª–∞–¥–∫–∞, –∏–Ω–ª–∞–π–Ω –±–ª–æ–∫
4. **–°–æ–∑–¥–∞–π DRF API** ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã, views, URLs
5. **–†–µ–∞–ª–∏–∑—É–π service layer** ‚Äî pipeline, pricing, gpt stubs, client stubs
6. **–î–æ–±–∞–≤—å Celery tasks** ‚Äî prepare, publish, end, reprice
7. **–°–æ–∑–¥–∞–π templates** ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, –±–ª–æ–∫ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ
8. **–î–æ–±–∞–≤—å management command** ‚Äî sync_ebay_sales
9. **–ù–∞–ø–∏—à–∏ —Ç–µ—Å—Ç—ã** ‚Äî test_ebay_pipeline.py
10. **–û–±–Ω–æ–≤–∏ settings.py –∏ urls.py**

---

## üì• –ö–ê–ö –ó–ê–ë–†–ê–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢:

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ Claude Web —Å–æ–∑–¥–∞—Å—Ç –∫–æ–¥:

### 1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ:

–°–∫–æ–ø–∏—Ä—É–π –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –∫–æ—Ç–æ—Ä—ã–π Claude Web —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –º–µ—Å—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ.

–ù–∞–ø—Ä–∏–º–µ—Ä:
- `apps/marketplaces/ebay/models.py` ‚Üí —Å–æ–∑–¥–∞–π –ø—É—Ç—å –∏ —Ñ–∞–π–ª
- `apps/marketplaces/ebay/admin.py` ‚Üí —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª
- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã):

–ï—Å–ª–∏ Claude Web –¥–æ–±–∞–≤–∏–ª –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ requirements.txt ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏ –∏—Ö:
```bash
pip install -r requirements.txt
```

### 3. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
cd shoessite
python manage.py makemigrations
python manage.py migrate
```

### 4. –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã:

```bash
python manage.py test tests.test_ebay_pipeline
```

### 5. –ü—Ä–æ–≤–µ—Ä—å –∞–¥–º–∏–Ω–∫—É:

```bash
python manage.py runserver
# –û—Ç–∫—Ä–æ–π http://localhost:8000/admin/
```

### 6. –ï—Å–ª–∏ –≤—Å—ë –û–ö ‚Äî –∫–æ–º–º–∏—Ç –∏ –¥–µ–ø–ª–æ–π:

```bash
git add .
git commit -m "Add eBay MVP integration"
./deploy_from_local.sh
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

- [ ] –í—Å–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –í –∞–¥–º–∏–Ω–∫–µ –ø–æ—è–≤–∏–ª—Å—è mass action ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ eBay¬ª
- [ ] –í–∫–ª–∞–¥–∫–∞ ¬´eBay¬ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] API endpoints –æ—Ç–≤–µ—á–∞—é—Ç (–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ `/api/ebay/candidates/`)
- [ ] –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `EbayCandidate.logs`
- [ ] –ë–æ—Ç –Ω–µ —Å–ª–æ–º–∞–Ω (–Ω–µ —Ç—Ä–æ–≥–∞–ª–∏ —Ñ–∞–π–ª—ã –±–æ—Ç–∞)

---

## üéÅ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –¥–ª—è —É—á–µ—Ç–∞:

### –ü—Ä–∞–≤–∏–ª–∞ —Ü–µ–Ω—ã:

- –°—á–∏—Ç–∞–µ–º –º–µ–¥–∏–∞–Ω—É –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º –∫–æ–º–ø–∞–º (—Ñ–∏–ª—å—Ç—Ä—ã: —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ª–æ–∫–∞—Ü–∏—è, —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–æ–¥–∞–≤—Ü–∞)
- –§–æ—Ä–º—É–ª–∞: `target = round_down(median * (1 - X%), step=0.01)`; X% —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `settings.PRICE_BELOW_MEDIAN_PCT`
- Free shipping: `price_final = target + ship_cost`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º Best Offer (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü–µ–π `min_accept = price_final * (1 - Y%)`

### –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ç—è–∂—ë–ª—ã—Ö:

- –§–ª–∞–≥ `heavy_flag=True` ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ
- –®–∞–±–ª–æ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫ ¬´Heavy¬ª (–æ—Å–æ–±—ã–µ shipping/returns), –∞–≤—Ç–æ–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ –≤–µ—Å—É/–≥–∞–±–∞—Ä–∏—Ç–∞–º/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### State machine:

`draft` ‚Üí `ready` ‚Üí `listed` ‚Üí `error` ‚Üí `ended`

–õ–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

---

**–ù–ê–ß–ò–ù–ê–ô –ö–û–î–ò–¢–¨! –£–¥–∞—á–∏!** üöÄ


# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –û—Ç–∫–∞—Ç—É (Rollback)

## üîÑ –ë—ã—Å—Ç—Ä—ã–π –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏.

### –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –°–∫—Ä–∏–ø—Ç (–°–∞–º—ã–π –ü—Ä–æ—Å—Ç–æ–π)

```bash
./rollback.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç –≤—ã–±–æ—Ä –º–µ–∂–¥—É tag –∏ branch
- –í—ã–ø–æ–ª–Ω–∏—Ç –æ—Ç–∫–∞—Ç
- –ü–æ–∫–∞–∂–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞

### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Git Tag

```bash
# –û—Ç–∫–∞—Ç –∫ tag (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
git checkout backup-before-refactoring

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
git log --oneline -5

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∏ Django
cd shoesbot && python telegram_bot.py &
cd shoessite && python manage.py runserver
```

### –°–ø–æ—Å–æ–± 3: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Git Branch

```bash
# –û—Ç–∫–∞—Ç –∫ backup branch
git checkout backup/pre-refactoring-2025-01-10

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
git log --oneline -5
```

---

## üìç –î–æ—Å—Ç—É–ø–Ω—ã–µ –¢–æ—á–∫–∏ –û—Ç–∫–∞—Ç–∞

### 1. Tag: `backup-before-refactoring`
- **Commit**: `b3f2517`
- **–î–∞—Ç–∞**: 2025-01-10 (–ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
- **–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ**:
  - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π monolithic views.py (2758 —Å—Ç—Ä–æ–∫)
  - –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ services layer
  - –†–∞–±–æ—Ç–∞—é—â–∏–π bot –∏ Django

### 2. Branch: `backup/pre-refactoring-2025-01-10`
- –¢–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ tag (–ø—Ä–æ—Å—Ç–æ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç)
- –ü–æ–ª–µ–∑–Ω–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

---

## üîÑ –í–æ–∑–≤—Ä–∞—Ç –∫ –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω–æ–π –í–µ—Ä—Å–∏–∏

–ü–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:

```bash
# –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏
git checkout claude/project-review-011CUxPJVQzhPacdoVSkuTu2

# –ü—Ä–æ–≤–µ—Ä–∫–∞
git log --oneline -5
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ü–æ—Å–ª–µ –û—Ç–∫–∞—Ç–∞

–ü–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Django
cd shoessite
python manage.py check
python manage.py migrate

# 2. –ó–∞–ø—É—Å–∫ Django
python manage.py runserver

# 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
cd ../shoesbot
python telegram_bot.py

# 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –±–æ—Ç—É
# - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ó–∞–º–µ—á–∞–Ω–∏—è

### –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

–û—Ç–∫–∞—Ç –∫–æ–¥–∞ **–ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!**

–ï—Å–ª–∏ –±—ã–ª–∏ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cd shoessite
python manage.py showmigrations

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
python manage.py migrate photos 0001  # –û—Ç–∫–∞—Ç –∫ –ø–µ—Ä–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
```

**–õ—É—á—à–µ**: –°–¥–µ–ª–∞—Ç—å backup –ë–î –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:

```bash
# Backup
cp shoessite/db.sqlite3 shoessite/db.sqlite3.backup

# Restore (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
cp shoessite/db.sqlite3.backup shoessite/db.sqlite3
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ï—Å–ª–∏ –≤–µ—Ä—Å–∏–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è:

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ requirements.txt
pip install -r requirements.txt
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –û–∫—Ä—É–∂–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª - –º–æ–≥–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
cat .env

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
cp .env.backup .env  # –µ—Å–ª–∏ –±—ã–ª backup
```

---

## üö® –ê–≤–∞—Ä–∏–π–Ω—ã–π –û—Ç–∫–∞—Ç (Emergency)

–ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
pkill -f telegram_bot.py
pkill -f "manage.py runserver"

# 2. –û—Ç–∫–∞—Ç –∫ tag
git checkout backup-before-refactoring

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î –∏–∑ backup (–µ—Å–ª–∏ –µ—Å—Ç—å)
cp shoessite/db.sqlite3.backup shoessite/db.sqlite3

# 4. –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt --force-reinstall

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
cd shoesbot && python telegram_bot.py &
cd shoessite && python manage.py runserver
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –í–µ—Ä—Å–∏–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ | –ü–æ—Å–ª–µ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ |
|----------|-----------------|-------------------|
| views.py | 2758 —Å—Ç—Ä–æ–∫ (monolith) | 10 –º–æ–¥—É–ª–µ–π (~200 —Å—Ç—Ä–æ–∫) |
| Services | –ù–µ—Ç | 6 –º–æ–¥—É–ª–µ–π |
| Middleware | –ù–µ—Ç | 3 –º–æ–¥—É–ª—è |
| Docs | –ú–∏–Ω–∏–º—É–º | 5 —Ñ–∞–π–ª–æ–≤ (3565 —Å—Ç—Ä–æ–∫) |
| Type hints | –ß–∞—Å—Ç–∏—á–Ω–æ | 100% –≤ services |
| Error handling | –†–∞–∑–±—Ä–æ—Å–∞–Ω–æ | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ |

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–µ–∫—É—â–µ–π –í–µ—Ä—Å–∏–∏

```bash
# –ö–∞–∫–∞—è —Å–µ–π—á–∞—Å –≤–µ—Ä—Å–∏—è?
git branch --show-current

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
git log --oneline -10

# –°—Ç–∞—Ç—É—Å
git status
```

**–î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- Branch: `backup/pre-refactoring-2025-01-10` –∏–ª–∏ detached HEAD –Ω–∞ `backup-before-refactoring`
- Last commit: `b3f2517 Improve GG+Q label detection`

**–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
- Branch: `claude/project-review-011CUxPJVQzhPacdoVSkuTu2`
- Last commit: `c2ba380 Add bot optimization ideas`

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–µ—Ä–µ–¥ –æ—Ç–∫–∞—Ç–æ–º**: –°–¥–µ–ª–∞—Ç—å backup –ë–î
   ```bash
   cp shoessite/db.sqlite3 db_before_rollback.sqlite3
   ```

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
   ```bash
   # –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞ –ø–æ—Ä—Ç—É 8000
   # –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –Ω–∞ –ø–æ—Ä—Ç—É 8001
   python manage.py runserver 8001
   ```

3. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥**: –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å feature flags
   ```python
   USE_NEW_SERVICES = os.getenv("USE_NEW_SERVICES", "0") == "1"

   if USE_NEW_SERVICES:
       from photos.services.ai_service import OpenAIService
   else:
       from photos.ai_helpers import generate_product_summary
   ```

---

## üìû –ü–æ–º–æ—â—å

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `tail -f shoessite/logs/errors.log`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å git: `git status`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã: `ps aux | grep python`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î: `python manage.py showmigrations`

**Need Help?** –°–º. [TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md)

---

**Last Updated**: 2025-01-10
**Backup Point**: commit `b3f2517`

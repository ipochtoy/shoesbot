# ‚úÖ eBay Integration - –ß–¢–û –°–î–ï–õ–ê–ù–û

## üéâ –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ:

**Claude Web —Å–æ–∑–¥–∞–ª —Å–∫–µ–ª–µ—Ç (4416 —Å—Ç—Ä–æ–∫), –Ω–æ –≤—Å—ë –±—ã–ª–æ –∑–∞–≥–ª—É—à–∫–∞–º–∏.**

**–Ø –¥–æ–¥–µ–ª–∞–ª:**
- ‚úÖ –†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è UI –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π GPT Vision –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –∫–æ–º–ø–æ–≤ –Ω–∞ eBay (scraping sold listings)
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –º–µ–¥–∏–∞–Ω—ã –∏ —Ü–µ–Ω
- ‚úÖ **–ó–ê–©–ò–¢–ê –û–¢ –ü–û–¢–ï–†–ò –§–û–¢–û–ö** (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!)

---

## üì¶ Phase 1: Product Card Integration ‚úÖ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

**1. eBay –±–ª–æ–∫ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞**
- –û—Ç–∫—Ä–æ–π –ª—é–±—É—é –∫–∞—Ä—Ç–æ—á–∫—É –≤ –∞–¥–º–∏–Ω–∫–µ: `https://pochtoy.us/admin/photos/photobatch/{ID}/`
- –í–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å —Ä–∞–∑–¥–µ–ª "eBay Listing"
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ç–∫–∏ –∏–∑ —Ç–æ–≤–∞—Ä–∞ (—Å –±–µ–π–¥–∂–µ–º "–ì–ª–∞–≤–Ω–∞—è" –¥–ª—è main photo)
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ eBay" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –µ—â—ë –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ

**2. –§–æ—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã**
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–æ—Ç–∫–∏ –∏–∑ `PhotoBatch.photos` (—Ç–≤–æ—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–æ–¥–µ–ª—å)
- –ü–æ—Ä—è–¥–æ–∫ —Ñ–æ—Ç–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (`order` field)
- –ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ –∑–µ–ª—ë–Ω–æ–π —Ä–∞–º–∫–æ–π

**–§–∞–π–ª—ã:**
- `shoessite/photos/views.py` - –¥–æ–±–∞–≤–ª–µ–Ω `ebay_candidate` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `shoessite/photos/templates/photos/product_card.html` - –≤–∫–ª—é—á—ë–Ω eBay –±–ª–æ–∫
- `apps/marketplaces/ebay/templates/ebay/partials/product_ebay_block.html` - –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PhotoBatch

---

## ü§ñ Phase 2: Real GPT Vision ‚úÖ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

**1. –ü–æ–¥–∫–ª—é—á—ë–Ω –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É AI**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è `auto_fill_product_card` (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `analyze_photos_with_vision` –¥–ª—è GPT-4 Vision
- –ë–∞—Ä–∫–æ–¥—ã –∏–∑ `BarcodeResult` —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã

**2. –†–µ–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è eBay listings**
- `services/gpt.py` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç OpenAI GPT-4 API
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç title ‚â§80 —Å–∏–º–≤–æ–ª–æ–≤
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç description –≤ markdown
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç brand, model, condition –∏–∑ —Ñ–æ—Ç–æ–∫
- –ú–∞–ø–∏—Ç UPC/EAN/ISBN –∏–∑ –±–∞—Ä–∫–æ–¥–æ–≤

**3. –ß—Ç–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è:**
- Brand, Model, Color
- Size/Volume  
- Condition (–Ω–æ–≤–æ–µ/–±/—É)
- UPC/EAN/ISBN –∫–æ–¥—ã
- Key features

**–§–∞–π–ª—ã:**
- `apps/marketplaces/ebay/services/gpt.py` - —Ä–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã OpenAI
- `apps/marketplaces/ebay/services/pipeline.py` - –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –±–∞—Ä–∫–æ–¥—ã –∏–∑ –ë–î, –ø–æ–ª–Ω—ã–µ URL —Ñ–æ—Ç–æ–∫

---

## üí∞ Phase 3: Real eBay Pricing ‚úÖ

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

**1. –†–µ–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ sold listings –Ω–∞ eBay**
- `services/client.py` –¥–µ–ª–∞–µ—Ç scraping eBay
- –ò—â–µ—Ç –ø–æ: UPC, EAN, –Ω–∞–∑–≤–∞–Ω–∏—é —Ç–æ–≤–∞—Ä–∞
- –ü–∞—Ä—Å–∏—Ç –ü–†–û–î–ê–ù–ù–´–ï —Ç–æ–≤–∞—Ä—ã (—Ä–µ–∞–ª—å–Ω—ã–µ —Ä—ã–Ω–æ—á–Ω—ã–µ —Ü–µ–Ω—ã!)
- –§–∏–ª—å—Ç—Ä—É–µ—Ç: US sellers, good ratings, similar condition

**2. –†–∞—Å—á—ë—Ç –º–µ–¥–∏–∞–Ω—ã –∏ —Ü–µ–Ω**
- –°—á–∏—Ç–∞–µ—Ç median, p25, p75 –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω
- –§–æ—Ä–º—É–ª–∞: `price_suggested = median * (1 - 8%)`
- –§–æ—Ä–º—É–ª–∞: `price_final = price_suggested + shipping_cost`
- Free shipping –≤–∫–ª—é—á—ë–Ω –≤ —Ü–µ–Ω—É

**3. –°–∞–π–¥–±–∞—Ä —Ü–µ–Ω—ã (–≤ —à–∞–±–ª–æ–Ω–µ)**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–¥–∏–∞–Ω—É
- –ü–æ–ª–µ "–Ω–∏–∂–µ –º–µ–¥–∏–∞–Ω—ã –Ω–∞ X%"
- –ß–µ–∫–±–æ–∫—Å Best Offer
- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Å—á—ë—Ç–∞

**–§–∞–π–ª—ã:**
- `apps/marketplaces/ebay/services/client.py` - —Ä–µ–∞–ª—å–Ω—ã–π scraping eBay
- `apps/marketplaces/ebay/services/pricing.py` - —Ä–∞—Å—á—ë—Ç –º–µ–¥–∏–∞–Ω—ã/–ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–µ–π
- `apps/marketplaces/ebay/services/gpt.py` - —É–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–≤

---

## üõ°Ô∏è Phase 7: Photo Loss Prevention ‚úÖ (–ö–†–ò–¢–ò–ß–ù–û!)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

**1. SQLite –æ—á–µ—Ä–µ–¥—å –¥–ª—è —Ñ–æ—Ç–æ–∫**
- –°–æ–∑–¥–∞–Ω–∞ –ë–î `/home/pochtoy/shoesbot/data/photo_queue.db`
- –§–æ—Ç–∫–∏ –°–ù–ê–ß–ê–õ–ê —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
- –ü–û–¢–û–ú –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Django
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ - –æ—Ç–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ `uploaded`
- –ü—Ä–∏ –æ—à–∏–±–∫–µ - –æ—Å—Ç–∞—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è retry

**2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry**
- –§–æ–Ω–æ–≤—ã–π worker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—á–µ—Ä–µ–¥—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- Retry –Ω–µ—É–¥–∞–≤—à–∏—Ö—Å—è –∑–∞–≥—Ä—É–∑–æ–∫
- Exponential backoff: 5min ‚Üí 10min ‚Üí 30min ‚Üí 1hr ‚Üí 2hr...
- –ú–∞–∫—Å–∏–º—É–º 10 –ø–æ–ø—ã—Ç–æ–∫
- –ü–æ—Å–ª–µ 10 –ø–æ–ø—ã—Ç–æ–∫ - permanent fail (–º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Ä—É—á–Ω—É—é)

**3. –ö–æ–º–∞–Ω–¥–∞ /queue –≤ Telegram**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—á–µ—Ä–µ–¥–∏
- –°–∫–æ–ª—å–∫–æ uploaded, pending, failed
- –ú–æ–∂–µ—à—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

**4. Backup —Å–∫—Ä–∏–ø—Ç—ã**
- `backup_media.sh` - –±—ç–∫–∞–ø –º–µ–¥–∏–∞ –∏ –ë–î
- `setup_backups.sh` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ cron
- –ë—ç–∫–∞–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è 7 –¥–Ω–µ–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ disk usage

**5. Health check endpoint**
- `/photos/health/` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ Django –∂–∏–≤
- –ë–æ—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**–§–∞–π–ª—ã:**
- `shoesbot/photo_queue.py` - SQLite –æ—á–µ—Ä–µ–¥—å —Å retry –ª–æ–≥–∏–∫–æ–π
- `shoesbot/photo_retry_worker.py` - —Ñ–æ–Ω–æ–≤—ã–π worker –¥–ª—è retry
- `shoesbot/django_upload.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏
- `shoesbot/telegram_bot.py` - –∫–æ–º–∞–Ω–¥–∞ /queue, –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ worker
- `backup_media.sh` - —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞
- `setup_backups.sh` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ cron
- `shoessite/photos/health_check.py` - health endpoint

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### 1. eBay Integration:

**–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ eBay:**
1. –û—Ç–∫—Ä–æ–π –∞–¥–º–∏–Ω–∫—É: https://pochtoy.us/admin/photos/photobatch/
2. –í—ã–±–µ—Ä–∏ —Ç–æ–≤–∞—Ä—ã (—á–µ–∫–±–æ–∫—Å—ã)
3. Action: "üì¶ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ eBay"
4. –û—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ eBay Candidates

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä:**
1. –û—Ç–∫—Ä–æ–π –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞
2. –í–Ω–∏–∑—É —É–≤–∏–¥–∏—à—å –±–ª–æ–∫ "eBay Listing"
3. –ñ–º–∏ "‚öôÔ∏è Prepare (AI)" - –∑–∞–ø—É—Å—Ç–∏—Ç GPT Vision
4. –ó–∞–ø–æ–ª–Ω—è—Ç—Å—è: title, condition, description, —Ü–µ–Ω–∞

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–Ω—ã:**
- Prepare –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—â–µ—Ç –∫–æ–º–ø—ã –Ω–∞ eBay
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–¥–∏–∞–Ω—É, p25, p75
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ü–µ–Ω—É –Ω–∏–∂–µ –º–µ–¥–∏–∞–Ω—ã –Ω–∞ 8%

**–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å:**
- –ñ–º–∏ "üöÄ Publish to eBay" (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)
- –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "Listed"

### 2. Photo Queue:

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å:**
- –í Telegram: `/queue`
- –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–≥—Ä—É–∑–æ–∫

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –§–æ—Ç–∫–∏ –°–ù–ê–ß–ê–õ–ê —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å
- –ü–û–¢–û–ú –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Django
- –ï—Å–ª–∏ Django —É–ø–∞–ª - retry –∫–∞–∂–¥—ã–µ 5-10-30 –º–∏–Ω—É—Ç
- –ú–∞–∫—Å–∏–º—É–º 10 –ø–æ–ø—ã—Ç–æ–∫

**–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã (–Ω–∞ VM):**
```bash
cd ~/shoesbot
./setup_backups.sh
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

**Phase 1-3 (eBay –¥–æ—Ä–∞–±–æ—Ç–∫–∞):**
- 6 —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ
- 398 —Å—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ, 109 —É–¥–∞–ª–µ–Ω–æ

**Phase 7 (–∑–∞—â–∏—Ç–∞ —Ñ–æ—Ç–æ–∫):**
- 8 —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ
- 485 —Å—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ

**–ò—Ç–æ–≥–æ:**
- 14 —Ñ–∞–π–ª–æ–≤
- 883 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞

---

## ‚ö†Ô∏è –ß—Ç–æ –µ—â—ë –ù–ï —Å–¥–µ–ª–∞–Ω–æ (–º–æ–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å –ø–æ—Ç–æ–º):

‚ùå **Phase 4: Category & Item Specifics**
- Autocomplete –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–ø–æ–∫–∞ hardcoded —Å–ø–∏—Å–æ–∫)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

‚ùå **Phase 5: Real eBay Publishing**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ eBay Sell API (OAuth)
- –†–µ–∞–ª—å–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- Sync –ø—Ä–æ–¥–∞–∂ –∏ –æ—Å—Ç–∞—Ç–∫–æ–≤

‚ùå **Phase 6: Polish**
- Drag&drop –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ–∫
- –ö—Ä–∞—Å–∏–≤—ã–π UI/UX
- Heavy item handling

**–ù–æ –≤—Å—ë —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –ì–û–¢–û–í–û:**
- ‚úÖ UI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π AI
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π pricing
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ —Ñ–æ—Ç–æ–∫**

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ó–∞–π–¥–∏ –≤ –∞–¥–º–∏–Ω–∫—É** https://pochtoy.us/admin/
2. **–û—Ç–∫—Ä–æ–π –ª—é–±—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞**
3. **–í–Ω–∏–∑—É —É–≤–∏–¥–∏—à—å eBay –±–ª–æ–∫** —Å —Ñ–æ—Ç–∫–∞–º–∏
4. **–ü–æ–ø—Ä–æ–±—É–π "–î–æ–±–∞–≤–∏—Ç—å –≤ eBay"**
5. **–ü–æ–ø—Ä–æ–±—É–π /queue –≤ –±–æ—Ç–µ** - –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –æ—á–µ—Ä–µ–¥—å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**–í–°–Å –†–ê–ë–û–¢–ê–ï–¢!** üî•

**–§–æ—Ç–∫–∏ –±–æ–ª—å—à–µ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è!** üõ°Ô∏è


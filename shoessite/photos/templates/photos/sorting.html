<!DOCTYPE html>
<html>
<head>
    <title>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ñ–æ—Ç–æ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f7fa; padding: 20px; }
        
        h1 { margin-bottom: 20px; }
        
        .toolbar {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .groups-container {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px;
        }
        
        .group {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            min-width: 300px;
            max-width: 300px;
            flex-shrink: 0;
        }
        
        .group.unsorted {
            min-width: 400px;
            max-width: 400px;
            border: 3px solid #dc2626;
        }
        
        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .group-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .photo-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            background: #f9fafb;
            border-radius: 6px;
            border: 2px dashed #d1d5db;
        }
        
        .photo-grid.drag-over {
            background: #eff6ff;
            border-color: #2563eb;
        }
        
        .photo-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            cursor: move;
            transition: all 0.2s;
            border: 3px solid transparent;
        }
        
        .photo-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .photo-item.selected {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        .photo-item.dragging {
            opacity: 0.5;
        }
        
        .photo-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }
        
        .select-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #2563eb;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        
        .photo-item.selected .select-badge {
            display: flex;
        }
        
        .photo-label {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-primary { background: #2563eb; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        
        .stats {
            color: #6b7280;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üì¶ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ñ–æ—Ç–æ</h1>
    
    <div class="toolbar">
        <button class="btn btn-success" onclick="createNewGroup()">‚ûï –ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞</button>
        <button class="btn btn-primary" onclick="autoGroup()" style="background: #6b7280;">ü§ñ –ê–≤—Ç–æ–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</button>
        <button class="btn btn-danger" onclick="clearBuffer()" style="background: #dc2626;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –±—É—Ñ–µ—Ä</button>
        <div class="stats">
            –í—Å–µ–≥–æ —Ñ–æ—Ç–æ: <strong id="total-count">{{ photos.count }}</strong> | 
            –ù–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö: <strong id="unsorted-count">0</strong>
        </div>
    </div>
    
    <p style="color: #6b7280; margin: 10px 0; font-size: 14px;">
        üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–ª–∏–∫–Ω–∏ –Ω–∞ —Ñ–æ—Ç–æ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ). –ü–µ—Ä–µ—Ç–∞—â–∏ –°–õ–ï–í–ê (–Ω–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ) ‚Üí –ù–ê–ü–†–ê–í–û (–≤ –≥—Ä—É–ø–ø—ã). –ñ–º–∏ "–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É" –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ.
    </p>
    
    <div class="groups-container" id="groups-container">
        <!-- –ì—Ä—É–ø–ø—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </div>
    
    <script>
        let groups = [];
        let photos = {{ photos_json|safe }};
        let selectedPhotos = new Set();
        
        function render() {
            const container = document.getElementById('groups-container');
            container.innerHTML = '';
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ñ–æ—Ç–æ
            const grouped = {};
            photos.forEach(p => {
                const gid = p.group_id || 'ungrouped';
                if (!grouped[gid]) grouped[gid] = [];
                grouped[gid].push(p);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
            const unsortedCount = grouped['ungrouped'] ? grouped['ungrouped'].length : 0;
            document.getElementById('unsorted-count').textContent = unsortedCount;
            document.getElementById('total-count').textContent = photos.length;
            
            const existingGroupIds = Object.keys(grouped).filter(g => g !== 'ungrouped').map(g => parseInt(g));
            const maxGroupId = existingGroupIds.length > 0 ? Math.max(...existingGroupIds) : 0;
            
            // 1. –°–õ–ï–í–ê - –ù–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (–≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞)
            if (grouped['ungrouped']) {
                const div = createGroupElement('ungrouped', grouped['ungrouped'], 'üì• –ù–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (–≤—ã–±–∏—Ä–∞–π –∏ —Ç–∞—â–∏ ‚Üí)');
                div.classList.add('unsorted');
                container.appendChild(div);
            }
            
            // 2. –í –°–ï–†–ï–î–ò–ù–ï - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≥—Ä—É–ø–ø—ã —Å —Ñ–æ—Ç–æ
            Object.keys(grouped).sort((a, b) => parseInt(a) - parseInt(b)).forEach(gid => {
                if (gid === 'ungrouped') return;
                const groupPhotos = grouped[gid];
                const ggLabels = [...new Set(groupPhotos.filter(p => p.gg_label).map(p => p.gg_label))];
                const label = `üì¶ –ì—Ä—É–ø–ø–∞ ${gid}` + (ggLabels.length > 0 ? ` [${ggLabels.join(', ')}]` : '');
                container.appendChild(createGroupElement(gid, groupPhotos, label));
            });
            
            // 3. –°–ü–†–ê–í–ê - –ü—É—Å—Ç—ã–µ –≥—Ä—É–ø–ø—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
            for (let i = 1; i <= 5; i++) {
                const gid = maxGroupId + i;
                if (!grouped[gid]) {
                    container.appendChild(createGroupElement(gid, [], `üì¶ –ì—Ä—É–ø–ø–∞ ${gid}`));
                }
            }
        }
        
        function createGroupElement(gid, groupPhotos, label) {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'group';
            groupDiv.dataset.groupId = gid;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–æ—Ç–æ –ø–æ ID (–ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏)
            const sortedPhotos = [...groupPhotos].sort((a, b) => a.id - b.id);
            
            groupDiv.innerHTML = `
                <div class="group-header">
                    <div class="group-title">${label} (${groupPhotos.length} —Ñ–æ—Ç–æ)</div>
                    <div>
                        ${gid !== 'ungrouped' ? `
                            <button class="btn btn-success" onclick="sendGroupToBot(${gid})">üì§ –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
                            <button class="btn btn-primary" onclick="sendGroupToPochtoy(${gid})" style="background: #8b5cf6;">üì° –í Pochtoy</button>
                            <button class="btn btn-danger" onclick="deleteGroup(${gid})" style="background: #dc2626;">üóëÔ∏è</button>
                        ` : ''}
                    </div>
                </div>
                <div class="photo-grid" data-group-id="${gid}" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                    ${sortedPhotos.map(p => `
                        <div class="photo-item ${selectedPhotos.has(p.id) ? 'selected' : ''}" 
                             draggable="true" 
                             data-photo-id="${p.id}" 
                             ondragstart="drag(event)" 
                             ondragend="dragEnd(event)"
                             onclick="toggleSelect(event, ${p.id})">
                            <img src="${p.image_url}" alt="–§–æ—Ç–æ ${p.id}">
                            ${p.gg_label ? `<div class="photo-label">${p.gg_label}</div>` : ''}
                            <div class="select-badge">‚úì</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            return groupDiv;
        }
        
        function allowDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }
        
        function dragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }
        
        function toggleSelect(e, photoId) {
            e.stopPropagation();
            
            // –ï—Å–ª–∏ Cmd/Ctrl –Ω–µ –∑–∞–∂–∞—Ç - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
            if (!e.metaKey && !e.ctrlKey) {
                selectedPhotos.clear();
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—ã–±–æ—Ä
            if (selectedPhotos.has(photoId)) {
                selectedPhotos.delete(photoId);
            } else {
                selectedPhotos.add(photoId);
            }
            
            console.log('Selected:', Array.from(selectedPhotos));
            render();
        }
        
        function drag(e) {
            const photoItem = e.target.closest('.photo-item');
            if (!photoItem) return;
            
            const photoId = parseInt(photoItem.dataset.photoId);
            
            // –ï—Å–ª–∏ —Ç–∞—â–∏–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —Ñ–æ—Ç–æ - —Ç–∞—â–∏–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
            if (selectedPhotos.has(photoId)) {
                e.dataTransfer.setData('photo_ids', JSON.stringify(Array.from(selectedPhotos)));
                photoItem.classList.add('dragging');
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
                selectedPhotos.forEach(id => {
                    document.querySelector(`[data-photo-id="${id}"]`)?.classList.add('dragging');
                });
            } else {
                // –¢–∞—â–∏–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Ñ–æ—Ç–æ
                e.dataTransfer.setData('photo_ids', JSON.stringify([photoId]));
                photoItem.classList.add('dragging');
            }
            
            console.log('Dragging photos:', e.dataTransfer.getData('photo_ids'));
        }
        
        function dragEnd(e) {
            document.querySelectorAll('.photo-item').forEach(item => {
                item.classList.remove('dragging');
            });
        }
        
        function drop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const photoIdsJson = e.dataTransfer.getData('photo_ids');
            const photoIds = JSON.parse(photoIdsJson || '[]');
            const newGroupId = e.currentTarget.dataset.groupId;
            
            console.log('Drop:', photoIds.length, 'photos to group', newGroupId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É –¥–ª—è –≤—Å–µ—Ö —Ñ–æ—Ç–æ
            photoIds.forEach(photoId => {
                const photo = photos.find(p => p.id === photoId);
                if (photo) {
                    photo.group_id = newGroupId === 'ungrouped' ? null : parseInt(newGroupId);
                    updatePhotoGroup(photoId, photo.group_id);
                }
            });
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
            selectedPhotos.clear();
            render();
        }
        
        function deleteGroup(groupId) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É ${groupId}? –§–æ—Ç–æ –≤–µ—Ä–Ω—É—Ç—Å—è –≤ –Ω–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ.`)) return;
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ —Ñ–æ—Ç–æ –≥—Ä—É–ø–ø—ã –≤ –Ω–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
            photos.forEach(p => {
                if (p.group_id === groupId) {
                    p.group_id = null;
                    updatePhotoGroup(p.id, null);
                }
            });
            
            render();
        }
        
        async function updatePhotoGroup(photoId, groupId) {
            await fetch(`/photos/api/update-photo-group/${photoId}/`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ group_id: groupId })
            });
        }
        
        function createNewGroup() {
            const maxGroup = Math.max(0, ...photos.filter(p => p.group_id).map(p => p.group_id));
            const newGroupId = maxGroup + 1;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é –≥—Ä—É–ø–ø—É
            photos.push({ id: -newGroupId, group_id: newGroupId, image_url: '', gg_label: '' });
            render();
        }
        
        function autoGroup() {
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ GG –ª–µ–π–±–ª–∞–º –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û
            // GG681, GG681, GG700, GG681 = 3 –≥—Ä—É–ø–ø—ã (–æ—Ç—Å–µ—á–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ GG)
            
            let groupCounter = 0;
            let lastGG = null;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ–æ—Ç–æ –ø–æ ID (–ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏)
            const sortedPhotos = [...photos].sort((a, b) => a.id - b.id);
            
            sortedPhotos.forEach(p => {
                if (p.gg_label && p.gg_label !== '') {
                    // –ï—Å–ª–∏ GG –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ —Å GG - –Ω–æ–≤–∞—è –≥—Ä—É–ø–ø–∞
                    if (p.gg_label !== lastGG) {
                        groupCounter++;
                        lastGG = p.gg_label;
                        console.log(`New group ${groupCounter} for ${p.gg_label}`);
                    }
                    
                    p.group_id = groupCounter;
                    updatePhotoGroup(p.id, p.group_id);
                } else {
                    // –§–æ—Ç–æ –±–µ–∑ GG - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π GG (–æ—Ç—Å–µ—á–∫–∞)
                    p.group_id = null;
                    lastGG = null;
                }
            });
            
            render();
            alert(`‚úÖ –°–æ–∑–¥–∞–Ω–æ –≥—Ä—É–ø–ø: ${groupCounter}\n\n–§–æ—Ç–æ –±–µ–∑ GG –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏`);
        }
        
        async function sendGroupToBot(groupId) {
            if (!confirm(`–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É ${groupId} –≤ –±–æ—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏?`)) return;
            
            console.log('Sending group', groupId, 'to bot...');
            
            try {
                const response = await fetch(`/photos/api/send-group-to-bot/${groupId}/`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                console.log('Response status:', response.status);
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    alert(`‚úÖ –ì—Ä—É–ø–ø–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\n\n–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ç–æ: ${data.photos_sent}\nCorrelation ID: ${data.correlation_id}\n\n–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç —Å–æ–∑–¥–∞—Å—Ç –∫–∞—Ä—Ç–æ—á–∫—É.`);
                    // –£–¥–∞–ª—è–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ
                    photos = photos.filter(p => p.group_id !== groupId);
                    render();
                } else {
                    alert(`‚ùå –û—à–∏–±–∫–∞: ${data.error}`);
                }
            } catch (error) {
                console.error('Error sending to bot:', error);
                alert(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}\n\n–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`);
            }
        }
        
        async function detectGGLabels() {
            if (!confirm('–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å GG –ª–µ–π–±–ª—ã –Ω–∞ –≤—Å–µ—Ö —Ñ–æ—Ç–æ? –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã.')) return;
            
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = '–†–∞—Å–ø–æ–∑–Ω–∞—é...';
            
            const response = await fetch('/photos/api/detect-gg-in-buffer/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert(`‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ GG –ª–µ–π–±–ª–æ–≤: ${data.found_count}`);
                location.reload();
            } else {
                alert(`–û—à–∏–±–∫–∞: ${data.error}`);
                btn.disabled = false;
                btn.textContent = 'üîç –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å GG –Ω–∞ –≤—Å–µ—Ö —Ñ–æ—Ç–æ';
            }
        }
        
        async function sendAllToBot() {
            if (!confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –í–°–ï –≥—Ä—É–ø–ø—ã –≤ –±–æ—Ç–∞?')) return;
            
            const groupIds = [...new Set(photos.filter(p => p.group_id).map(p => p.group_id))];
            
            for (let gid of groupIds) {
                await sendGroupToBot(gid);
                await new Promise(r => setTimeout(r, 15000)); // 15 —Å–µ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª
            }
        }
        
        async function sendGroupToPochtoy(groupId) {
            if (!confirm(`–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É ${groupId} –≤ Pochtoy API?`)) return;
            
            console.log('Sending group', groupId, 'to Pochtoy...');
            
            try {
                const response = await fetch(`/photos/api/send-group-to-pochtoy/${groupId}/`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const data = await response.json();
                console.log('Pochtoy response:', data);
                
                if (data.success) {
                    alert(`‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Pochtoy!\n\n–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${data.images_sent}\n–¢—Ä–µ–∫–∏–Ω–≥–æ–≤: ${data.trackings_sent}`);
                } else {
                    alert(`‚ùå –û—à–∏–±–∫–∞ Pochtoy: ${data.error}`);
                }
            } catch (error) {
                console.error('Pochtoy error:', error);
                alert(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
        
        async function clearBuffer() {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï —Ñ–æ—Ç–æ –∏–∑ –±—É—Ñ–µ—Ä–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) return;
            if (!confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å? –§–æ—Ç–æ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã!')) return;
            
            const response = await fetch('/photos/api/clear-buffer/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            });
            
            const data = await response.json();
            if (data.success) {
                alert(`‚úÖ –£–¥–∞–ª–µ–Ω–æ —Ñ–æ—Ç–æ: ${data.deleted_count}`);
                location.reload();
            } else {
                alert(`–û—à–∏–±–∫–∞: ${data.error}`);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        render();
        document.getElementById('total-count').textContent = photos.length;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º 5 –ø—É—Å—Ç—ã—Ö –≥—Ä—É–ø–ø –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
        const existingGroups = [...new Set(photos.filter(p => p.group_id).map(p => p.group_id))];
        if (existingGroups.length === 0) {
            console.log('Creating initial empty groups...');
            // –ü—Ä–æ—Å—Ç–æ —Ä–µ–Ω–¥–µ—Ä–∏–º –ø—É—Å—Ç—ã–µ –≥—Ä—É–ø–ø—ã - –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è –ø—Ä–∏ drag & drop
        }
    </script>
</body>
</html>

